
@{
    ViewBag.Title = "Vip明細";
}

@*Title*@
<div class="home-content">
    <span class="text" style="font-size:32px; font-weight:500; margin-left:10px;">Vip明細</span>
</div>

@*搜尋欄位和複選框*@
<div class="scrollable-container">
    <div class="row content m-3">
        <div class="col-3 text-center mt-4" >
            <input type="text" class="form-control" id="memberAccount" placeholder="搜尋帳號" style="height:40px; width:200px;">
        </div>
        <div class="col-lg-4">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="startDatePicker">起始時間：</label>
                    <div class="input-group date"
                         id="startDatePicker"
                         data-target-input="nearest">
                        <input type="text"
                               class="form-control datetimepicker-input"
                               data-target="#startDatePicker" />
                        <div class="input-group-append"
                             data-target="#startDatePicker"
                             data-toggle="datetimepicker">
                            <div class="input-group-text">
                                <i class="fas fa-calendar"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="endDatePicker">最終時間：</label>
                    <div class="input-group date"
                         id="endDatePicker"
                         data-target-input="nearest">
                        <input type="text"
                               class="form-control datetimepicker-input"
                               data-target="#endDatePicker" />
                        <div class="input-group-append"
                             data-target="#endDatePicker"
                             data-toggle="datetimepicker">
                            <div class="input-group-text">
                                <i class="fas fa-calendar"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-1 mt-4 " >
            <button id="searchButton" class="btn btn-outline-secondary" type="button" style="width:100px; height:40px; font-size:20px">搜尋</button>
        </div>
    </div>
</div>
<div class="table-container">
    <table id="vipTable" class="table table-striped table-hover table-bordered table-sm" style="width:100%;">
        <thead>
            <tr>
                <th>帳號</th>
                <th>姓名</th>
                <th>方案</th>
                <th>金額</th>
                <th>付款日期</th>
                <th>開始日期</th>
                <th>到期日期</th>
            </tr>
        </thead>
    </table>
</div>


<script>


    $(document).ready(function () {

        var startDate; // 在事件处理程序外部定义 startDate 和 endDate 变量
        var endDate;


         //Initialize DateTimePickers
        $(function () {
            $("#startDatePicker").datetimepicker({
                format: "YYYY-MM-DD",
                locale: "zh-tw", // 使用中文本地化
            });

            $("#endDatePicker").datetimepicker({
                format: "YYYY-MM-DD",
                locale: "zh-tw", // 使用中文本地化
            });
        });


        var table = $("#vipTable").DataTable({
            // DataTable 選項設置
            dom: "lrtp",
            responsive: true,
            pageLength: 10,
            pagingType: "full_numbers",
            ajax: {
                url: "/api/VipItemApi/",
                method: "POST",
                dataType: "json",
                data: function (d) {
                    d.MemberAccount = $("#memberAccount").val();
                    d.StartDate = $("#startDatePicker input").val();
                    d.EndDate = $("#endDatePicker input").val();
                },
                dataSrc: ""
            },
            columns: [
                { data: "MemberAccount" },
                { data: "MemberName" },
                { data: "Type" },
                { data: "Fee" },
                {
                    data: "PaymentDate"
                    ,
                    render: function (data, type, row) {
                        if (type === 'display') {
                            var date = new Date(data);
                            return date.toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit' });
                        }
                        return data;
                    }
                },
                {
                    data: "StartDate"
                    ,
                    render: function (data, type, row) {
                        if (type === 'display') {
                            var date = new Date(data);
                            return date.toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit' });
                        }
                        return data;
                    }
                },
                {
                    data: "ExpiryDate"
                    ,
                    render: function (data, type, row) {
                        if (type === 'display') {
                            var date = new Date(data);
                            return date.toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit' });
                        }
                        return data;
                    }
                },
            ]
        });



            // 搜索button event handler
            $("#searchButton").click(function () {
                var memberAccount = $("#memberAccount").val();
                startDate = $("#startDatePicker input").val(); // 获取手动输入的日期值
                endDate = $("#endDatePicker input").val();     // 获取手动输入的日期值


                console.log(memberAccount);
                console.log(startDate);
                console.log(endDate);

                if (memberAccount) {
                    // 使用搜索框可以搜索 MemberAccount
                    table.column(0).search(memberAccount).draw();
                } else if (startDate && endDate) {
                    // 使用日期范围进行搜索
                    table.column(4).search(startDate + ' to ' + endDate).draw();
                } else {
                    // 如果都没有选择，清空搜索并显示所有数据
                    table.search("").draw();
                }
            });

        // 監聽會員名稱输入框的 Enter 鍵按下事件
        $("#memberAccountInput").keypress(function (e) {
            if (e.which === 13) { // 13 代表 Enter 鍵
                updateTable();
            }
        });
        // 監聽搜尋按鈕點擊事件
        //$("#searchButton").click(function () {
        //    var memberAccount = $("#memberAccount").val();
        //    var startDate = $("#startDatePicker").datetimepicker('date');
        //    var endDate = $("#endDatePicker").datetimepicker('date');
        //    console.log(memberAccount);
        //    console.log(startDate);
        //    console.log(endDate);
        //    //$.ajax({
        //    //    url: "/api/VipItemApi/",
        //    //    method: "POST",
        //    //    dataType: "json",
        //    //    data: function (d) {
        //    //        d.MemberAccount = $("#memberAccount").val();
        //    //        d.StartDate = $("#startDatePicker").find("input").val;
        //    //        d.EndDate = $("#endDatePicker").find("input").val;
        //    //    },
        //    //    dataSrc: ""
        //    //});
        //    console.log("/api/VipItemApi?memberaccount=" + memberAccount + "&startdate=" + startDate + "&enddate=" + endDate);
        //    table.ajax.url("/api/VipItemApi?MemberAccount=" + memberAccount + "&StartDate=" + startDate + "&EndDate=" + endDate).load();

        //});

       



    });

</script>

